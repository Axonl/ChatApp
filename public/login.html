<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="style.css">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
</head>
<body>
    <h1>Registrer deg</h1>
    <form id="RegistrerForm">
        <label for="Brukernavn">Brukernavn:</label>
        <input type="text" id="reg-brukernavn" required>
        <br>
        <label for="Passord">Passord:</label>
        <input type="password" id="reg-passord" required>
        <br>
        <button type="submit">Registrer</button>
    </form>
    
    <h1>Logg inn</h1>
    <form id="LoginForm">
        <label for="Brukernavn">Brukernavn:</label>
        <input type="text" id="log-brukernavn" required>
        <br>
        <label for="Passord">Passord:</label>
        <input type="password" id="log-passord" required>
        <br>
        <button type="submit">Login</button>
    </form>

    <div id="meldinger"> <!--Feilmeldinger skal skrives ut her-->
        <!-- Javascript -->
    </div>

    
    <script>
        const RegistrerForm = document.getElementById('RegistrerForm');
        const RegBrukernavnEl = document.getElementById('reg-brukernavn');
        const RegPassordEl = document.getElementById('reg-passord');

        const LoginForm = document.getElementById('LoginForm');
        const LogBrukernavnEl = document.getElementById('log-brukernavn');
        const LogPassordEl = document.getElementById('log-passord');

        RegistrerForm.addEventListener("submit", registrer)

        async function registrer(e) {
            e.preventDefault();
            const brukernavn = RegBrukernavnEl.value;
            const passord = RegPassordEl.value;

            if (!brukernavn || !passord) {
                alert("Vennligst fyll ut alle felt.");
                return;
            }
            
            try {
                const response = await fetch("/signup", {
                    method: "POST",
                    headers:{ "Content-Type":"application/json" },
                    body: JSON.stringify({ brukernavn, passord})
               });
               const data = await response.json();
               if (response.ok) {
                   alert("Registrering vellykket! Du kan nå logge inn.");
                   window.location.href = "login.html";
               } else {
                   alert(`Feil: ${data.error}`);
               }
            }
            catch (error) {
                console.error("Feil under registrering:", error);
                alert("En feil oppstod under registreringen. Vennligst prøv igjen senere.");
            }
        }

        LoginForm.addEventListener("submit", login)

        async function login(e) {
            e.preventDefault();
            const brukernavn = LogBrukernavnEl.value;
            const passord = LogPassordEl.value;
            if (!brukernavn || !passord) {
                alert("Vennligst fyll ut alle felt.");
                return;
            }
            try {
                    const response = await fetch("/login", {
                        method: "POST",
                        headers:{ "Content-Type":"application/json" },
                        body: JSON.stringify({ brukernavn, passord})
                    });
                    const data = await response.json();
                    if (response.ok) {
                        sessionStorage.setItem('chatBrukernavn', brukernavn);                
                        alert(`Innlogging vellykket! Velkommen, ${brukernavn}.`);
                    window.location.href = "/rom";
                    } 
                    
                    else {alert(`Feil: ${data.error}`)};
                
                }
            
                catch (error) {
                console.error("Feil under innlogging:", error);
                alert("En feil oppstod under innloggingen. Vennligst prøv igjen senere.");
            }

    }
    </script>

</body>
</html>